// ========= CONTROLFILE =========

// Archivos
match /files/{fileId} {
  // READ público necesario para shares públicos vía Cloudflare Worker
  // El control de acceso real está en shares/{token} que valida expiración y estado
  // Los datos sensibles están en B2, no en Firestore
  allow read: if true;
  allow create: if isAuth() && request.resource.data.userId == uid();
  allow update, delete: if isAuth() && resource.data.userId == uid();
}

// Carpetas
match /folders/{folderId} {
  allow create: if isAuth() && request.resource.data.userId == uid();
  allow read, update, delete: if isAuth() && resource.data.userId == uid();
}

// Sesiones de upload
match /uploadSessions/{sessionId} {
  allow create: if isAuth() && request.resource.data.uid == uid();
  allow read, update, delete: if isAuth() && resource.data.uid == uid();
}

// ========= SHARES (GLOBAL) =========
match /shares/{shareId} {
  allow read, write: if true;
}

// Papelera
match /trash/{trashId} {
  allow create: if isAuth() && request.resource.data.userId == uid();
  allow read, update, delete: if isAuth() && resource.data.userId == uid();
}


